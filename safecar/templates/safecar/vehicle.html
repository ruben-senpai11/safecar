{% extends 'safecar/layouts/app.html' %}
{% load static %}
{% load formtag %}
{% block title %}   Detail du véhicule {%endblock%}

{% block breadcrumb%}
          <ol class="breadcrumb bg-transparent mb-0 pb-0 pt-1 px-0 me-sm-6 me-5">
          
            <li class="breadcrumb-item text-sm">
              <a class="opacity-5 text-white" onclick="history.back()">Retour</a>
            </li>
            <li class="breadcrumb-item text-sm text-white active" aria-current="page">Véhicule</li>
          </ol>
          <h6 class="font-weight-bolder text-white mb-0">Véhicule</h6>
{% endblock %}
{% block content %}
    <div class="container-fluid py-4">
      <div class="row">
        <div class="col-xl-3 col-sm-6 mb-4">
          <div class="card">
            <div class="card-body p-3">
              <div class="row">
                <div class="col-8">
                  <div class="numbers">
                    <p class="text-sm mb-0 text-uppercase font-weight-bold">Numero</p>
                    <h5 class="font-weight-bolder" nowrap>
                      {{car.plate_number}}
                    </h5>
                    
                  </div>
                </div>
                <div class="col-4 text-end">
                  <div class="icon icon-shape bg-gradient-warning shadow-warning text-center rounded-circle">
                    <i class="ni ni-tag text-lg opacity-10" aria-hidden="true"></i>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-xl-3 col-sm-6 mb-xl-0 mb-4">
          <div class="card">
            <div class="card-body p-3">
              <div class="row">
                <div class="col-8">
                  <div class="numbers">
                    <p class="text-sm mb-0 text-uppercase font-weight-bold">Type</p>
                    <h5 class="font-weight-bolder nowrap">
                      {{car.type.wording}} 
                    </h5>
                   
                  </div>
                </div>
                <div class="col-4 text-end">
                  <div class="icon icon-shape bg-gradient-danger shadow-danger text-center rounded-circle">
                    <i class="ni ni-world text-lg opacity-10" aria-hidden="true"></i>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-xl-3 col-sm-6 mb-xl-0 mb-4">
          <div class="card">
            <div class="card-body p-3">
              <div class="row">
                <div class="col-8">
                  <div class="numbers">
                    <p class="text-sm mb-0 text-uppercase font-weight-bold">Genre</p>
                    <h5 class="font-weight-bolder nowrap">
                      {{car.gender.wording}}
                    </h5>
                    
                  </div>
                </div>
                <div class="col-4 text-end">
                  <div class="icon icon-shape bg-gradient-primary shadow-primary text-center rounded-circle">
                    <i class="ni ni-money-coins text-lg opacity-10" aria-hidden="true"></i>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
       
        <div class="col-xl-3 col-sm-6 mb-xl-0 mb-4">
          <div class="card">
            <div class="card-body p-3">
              <div class="row">
                <div class="col-8">
                  <div class="numbers">
                    <p class="text-sm mb-0 text-uppercase font-weight-bold">Modele</p>
                    <h5 class="font-weight-bolder " nowrap>
                      <span class='d-block' nowrap>{{car.car_model}}</span> 
                    </h5>
                    
                  </div>
                </div>
                <div class="col-4 text-end">
                  <div class="icon icon-shape bg-gradient-success shadow-success text-center rounded-circle">
                    <i class="ni ni-paper-diploma text-lg opacity-10" aria-hidden="true"></i>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
     
      </div>
      <div class="row mt-4">
        <div class="col-lg-6 mb-lg-0 mb-4">
          <div class="card z-index-2 h-100">
            <div class="card-header pb-0 pt-3 bg-transparent">
              <h6 class="text-capitalize">Plaque:  {{car.plate_number}}</h6>
              <p class="text-sm mb-0">
                <i class="ni ni-calendar-grid-58"></i>
                <span class="font-weight-bold">inscrit le</span> {{car.create_at}}
              </p>
            </div>
            
          
            <div class="card-body p-3">
              <div class="col-md-12 ml-1">
                <div class="row">
                  <div class="col-7" ><label for="example-text-input" class="form-control-label">Genre</label></div>
                  <div class="col-5" >{{car.gender.wording}}</div>
                </div>
              </div>
              <div class="col-md-12 ml-1">
                <div class="row">
                  <div class="col-7" ><label for="example-text-input" class="form-control-label">Type</label></div>
                  <div class="col-5" >{{car.type.wording}}</div>
                </div>
              </div>
              <div class="col-md-12 ml-1">
                <div class="row">
                  <div class="col-7" ><label for="example-text-input" class="form-control-label">Modele</label></div>
                  <div class="col-5" >{{car.car_model}}</div>
                </div>
              </div>
              <div class="col-md-12 ml-1">
                <div class="row">
                  <div class="col-7" ><label for="example-text-input" class="form-control-label">Energie</label></div>
                  <div class="col-5" >{{car.energy.wording}}</div>
                </div>
              </div>

              <div class="col-md-12 ml-1">
                <div class="row">
                  <div class="col-7" ><label for="example-text-input" class="form-control-label">Poids à vide</label></div>
                  <div class="col-5" >{{car.empty_weight|ljust:"2"}}kg</div>
                </div>
              </div>
              <div class="col-md-12 ml-1">
                <div class="row">
                  <div class="col-7" ><label for="example-text-input" class="form-control-label">Charge utile</label></div>
                  <div class="col-5" >{{car.pay_load|ljust:"2"}}kg</div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-lg-6 mb-lg-0 mb-4">
          <div class="card z-index-2 h-100">
            <div class="card-header pb-0 pt-3 bg-transparent">
              <h6 class="text-capitalize">Information associée</h6>
            
            </div>
            
          
            <div class="card-body p-3">
              <div class="col-md-12 ml-1">
                <div class="row">
                  <div class="col-3 mr-1" ><label for="example-text-input" class="form-control-label">Assurance</label></div>
                  <div class="col-8" >
                    {% if assurance%} 
                    <small> 
                      {{assurance.agency.designation}}, le {{assurance.done_at|date:"d/m/Y"}},  validité: {{assurance.validity}} mois 
                    </small>
                    {% else %}
                    <small class="text-danger">Indisponible</small>
                    {% endif %}
                  </div>
                </div>
        
              </div>
    
              <div class="col-md-12 ml-1">
                <div class="row">
                  <div class="col-3 mr-1 mb-2" ><label for="example-text-input" class="form-control-label">Visite technique</label></div>
                  <div class="col-8" >
                    {% if technical_visit  %}
                    <small>
                     {{technical_visit.agency.designation}}, le {{technical_visit.done_at|date:"d/m/Y"}},  validité: {{technical_visit.validity}} mois 
                    </small>
                    {% else %}
                    <small class="text-danger">Indisponible</small>
                    {% endif %}
                  </div>
                </div>
        
              </div>
    
              <div class="col-md-12 ml-1">
                <div class="row">
                  <div class="col-3 mr-1 mb-2" ><label for="example-text-input" class="form-control-label">Abonnement au péage</label></div>
                  <div class="col-8" >
                    {% if  toll  %}
                    <small>
                      {{toll.agency.designation}}, le {{toll.done_at|date:"d/m/Y"}},  validité: {{toll.validity}} mois 
                    </small>
                    {% else %}
                    <small class="text-danger">Indisponible</small>
                    {% endif %}
                  </div>
                </div>
              </div>
              <div class="col-md-12 ml-1">
                <div class="row">
                  <div class="col-3 mr-1 mb-2" ><label for="example-text-input" class="form-control-label">Avis de recherche</label></div>
                  <div class="col-8" >
                    {% if stealing  %}
                    <small class="text-danger">
                        OUI, depuis le {{stealing.done_at|date:"d/m/Y"}}
                    </small>
                    {% else %}
                    <small> NON </small>
                    {% endif %}
                  </div>
                </div>
        
              </div>


            </div>
    
              
             
            
              
    
             
             
            </div>
          </div>
        </div>
      

      <div class="card shadow-lg mt-4 ">
        <div class="card-body p-3">
          <div class="row gx-4">
            <div class="col-auto">
              <div class="avatar avatar-xl position-relative">
                <img src="{{car.owner.user.profile_img.url}}" alt="profile_image" class="w-100 border-radius-lg shadow-sm">
              </div>
            </div>
            <div class="col-auto my-auto">
              <div class="h-100">
                <h5 class="mb-1">
                  {{car.owner.first_name|ljust:1 }} {{car.owner.last_name}} 
                </h5>
                <p class="mb-0 font-weight-bold text-sm">
                  {{car.owner.user.user_group.name}}
                </p>
              </div>
            </div>
            <div class="col-lg-8 col-md-6 my-sm-auto ms-sm-auto me-sm-0 mx-auto mt-3">
              <div class="nav-wrapper position-relative end-0">
                <ul class="nav nav-pills nav-fill p-1" role="tablist">
                  <li class="nav-item">
                    <a id='nav_profile' class="nav-link mb-0 px-0 py-1 active d-flex align-items-center justify-content-center " data-bs-toggle="tab" href="javascript:;" role="tab" aria-selected="true">
                      <i class="ni ni-app"></i>
                      <span class="ms-2">Profil</span>
                    </a>
                  </li>
                  <li class="nav-item">
                    <a id="nav_report" class="nav-link mb-0 px-0 py-1 d-flex align-items-center justify-content-center " data-bs-toggle="tab" href="javascript:;" role="tab" aria-selected="false">
                      <i class="ni ni-email-83"></i>
                      <span class="ms-2">Rapport</span>
                    </a>
                  </li>
                  <li class="nav-item">
                    <a id="nav_historical" class="nav-link mb-0 px-0 py-1 d-flex align-items-center justify-content-center " data-bs-toggle="tab" href="javascript:;" role="tab" aria-selected="false">
                      <i class="ni ni-email-83"></i>
                      <span class="ms-2">Historique</span>
                    </a>
                  </li>
                  <li class="nav-item">
                    <a id="nav_anomaly" class=" nav-link mb-0 px-0 py-1 d-flex align-items-center justify-content-center " data-bs-toggle="tab" href="javascript:;" role="tab" aria-selected="false">
                      <i class="ni ni-settings-gear-65"></i>
                      <span class="ms-2">Anomalie</span>
                    </a>
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div id='tab_layout'>

      <div  id="profile" >
        <div class="row">
          <div class="col-md-8  mt-4">
            <fieldset disabled >
              <div class="card">
                
                <div class="card-body">
                  <p class="text-uppercase text-sm">Information personnel</p>
                  <div class="row">
                    <div class="col-md-6">
                      <div class="form-group">
                        <label for="example-text-input" class="form-control-label">Nom d'utilisateur</label>
                        <input class="form-control" type="text" value="{{car.owner.user.username}}" placeholder="">
                      </div>
                    </div>
                    <div class="col-md-6">
                      <div class="form-group">
                        <label for="example-text-input" class="form-control-label">email</label>
                        <input class="form-control" type="email" value="{{car.owner.user.email}}">
                      </div>
                    </div>
                    <div class="col-md-6">
                      <div class="form-group">
                        <label for="example-text-input" class="form-control-label">Nom</label>
                        <input class="form-control" type="text" value="{{car.owner.last_name }}">
                      </div>
                    </div>
                    <div class="col-md-6">
                      <div class="form-group">
                        <label for="example-text-input" class="form-control-label">Prénom</label>
                        <input class="form-control" type="text" value="{{car.owner.first_name }}">
                      </div>
                    </div>
                    <div class="col-md-6">
                      <div class="form-group">
                        <label for="example-text-input" class="form-control-label">Date de naissance</label>
                        <input class="form-control" type="text" value="{{car.owner.birth_date }}">
                      </div>
                    </div>
                    <div class="col-md-6">
                      <div class="form-group">
                        <label for="example-text-input" class="form-control-label">Lieu de naissance</label> 
                        <input class="form-control" type="text" value="{{car.owner.birth_place }}">
                      </div>
                    </div>
      
                    <div class="col-md-6">
                      <div class="form-group">
                        <label for="example-text-input" class="form-control-label">Sexe</label>
                        <input class="form-control" type="text" value="{{car.owner.sex }}">
                      </div>
                    </div>
                    <div class="col-md-6">
                      <div class="form-group">
                        <label for="example-text-input" class="form-control-label">Profession</label>
                        <input class="form-control" type="text" value="{{car.owner.profession }}">
                      </div>
                    </div>
                  </div>
                  
                  
                
                </div>
              </div>
            </fieldset>
          </div>
          <div class="col-md-4  mt-4">
            <div class="card">
              
              <div class="card-body">
                <p class="text-uppercase text-sm">Information de contact</p>
                <div class="row">
                    <div class="col-md-12">
                        <div class="row">
                            <div class="col-5"><label for="example-text-input"
                                    class="form-control-label">Téléphone</label></div>
                            <div class="col-7 text-nowrap">{{ car.owner.phone_number}} </div>
                        </div>
                    </div>
                    <div class="col-md-12">
                        <div class="row">
                            <div class="col-5"><label for="example-text-input"
                                    class="form-control-label">Department</label></div>
                            <div class="col-7">{{car.owner.city.department.name}} </div>
                        </div>
                    </div>
    
                    <div class="col-md-12">
                        <div class="row">
                            <div class="col-5"><label for="example-text-input"
                                    class="form-control-label">Ville</label></div>
                            <div class="col-7">{{car.owner.city.name}}</div>
                        </div>
                    </div>
                    <div class="col-md-12">
                        <div class="row">
                            <div class="col-5"><label for="example-text-input"
                                    class="form-control-label">Quartier</label></div>
                            <div class="col-7">{{car.owner.district.name}}</div>
                        </div>
                    </div>
                    <hr class="horizontal dark">
                    <div class="col-md-12">
                        <div class="form-group">
                            <label for="example-text-input" class="form-control-label">Adresse</label>
                            <div class="h-25">{{car.owner.address}}</div>
    
                        </div>
                    </div>
    
    
                </div>
            </div>
            </div>
          </div>
        </div>
      </div>
    
      <div id="report" class="report">
        <div class="col-md-12 mt-4">
          <div class="card">
            <div class="card-header pb-0 px-3">
              <h6 class="mb-0">Les rapports de police</h6>
            </div>
            <div class="card-body pt-4 p-3">
              <ul class="list-group" id="accordionRental">
                {% for task  in car.operation_set|filter_type:'report' %}
                  <li class="list-group-item border-0 p-md-4 mb-2 bg-gray-100 border-radius-lg">
                    <div class="d-flex">
                      <div class="d-flex flex-column">
                        
                              <div class="mb-2  d-flex row">
                                <h6 class="text-sm row text-nowrap "> 
                                  <span>{{task.vehicle.car_model}} <span>N°:{{task.vehicle.plate_number|rjust:"10"}} </span></span>
      
                                </h6> 
                                <span class="mb-2 text-xs">{{task.vehicle.gender.wording}},{{task.vehicle.type.wording|rjust:"10"}} </span>
                              </div>
                        
                      
                      </div>
        
                    </div>
                    <div>
                      <div class="text-xs"><span class="text-dark ms-sm-2 font-weight-bold">Motif:  </span>{{task.motif}} </div>
                      <div class="text-xs"><span class="text-dark ms-sm-2 font-weight-bold">Acteur:  </span>{{task.agency.designation}} </div>
                      <div class="text-xs"><span class="text-dark ms-sm-2 font-weight-bold">Date:  </span>{{task.done_at}} </div>
                      <hr class="horizontal dark">
                      <div class=" row">
                        
                        <div class="  text-uppercase text-sm col-sm-8 mt-2">Description  </div>
                        <div class=" col-sm-4  text-end">
                          <a class="link btn-sm btn-primary px-3 me-3 py-1 text-center hideicon" data-bs-toggle="collapse" href="#collapseExample2" role="button" aria-expanded="false" aria-controls="collapseExample2"><i class="ni ni-bold-down text-white" aria-hidden="false"></i>
                        </a>
                        </div>
                      
                      </div>
                    
                      <div class="collapse" id="collapseExample2" data-bs-parent="#accordionRental">
                        {{task.description}}
                      </div>
                    </div>
                  </li>
                {% endfor %} 
              </ul>
            </div>
          </div>
        </div> 
      </div>
      
      <div id="anomaly" class="anomaly">
        <div class="col-md-12 mt-4">
          <div class="card">
            <div class="card-header pb-0 px-3">
              <h6 class="mb-0">Les anomalies </h6>
            </div>
            <div class="card-body pt-4 p-3">
              <ul class="list-group" id="accordionRental">
                {% for task in car.warning_set.all %}
                  <li class="list-group-item border-0 p-md-4 mb-2 bg-gray-100 border-radius-lg">
                    <div class="d-flex">
                      <div class="d-flex flex-column">
                        
                              <div class="mb-2  d-flex row">
                                <h6 class="text-sm row text-nowrap "> 
                                  <span>{{task.vehicle.car_model}} <span>N°:{{task.vehicle.plate_number|rjust:"10"}} </span></span>
  
                                </h6> 
                                <span class="mb-2 text-xs">{{task.vehicle.gender.wording}},{{task.vehicle.type.wording|rjust:"10"}} </span>
                              </div>
                        
                      
                      </div>
                      <form  class="ms-auto text-end">
                        {% csrf_token %}
                        <input type="hidden" name="id" value="{{task.id}}">
                        <button formaction="{% url 'anomaly_delete'%}" formmethod="post"  type="submit" class="btn btn-link text-danger text-gradient px-3 mb-0" ><i class="far fa-trash-alt me-2"></i>effacer</button>
                        <button formaction="{% url 'anomaly_add'%}" formmethod="get"   type="submit" class="btn btn-link text-dark px-3 mb-0" ><i class="fas fa-pencil-alt text-dark me-2" aria-hidden="true"></i>Editer</button>
                      </form>
                    </div>
                    <div>
                      <div class="text-xs"><span class="text-dark ms-sm-2 font-weight-bold">Motif:  </span>{{task.motif}} </div>
                      <div class="text-xs"><span class="text-dark ms-sm-2 font-weight-bold">Acteur:  </span>{{task.vehicle.owner.first_name|ljust:"10"}} {{task.vehicle.owner.last_name}}</div>
                      <div class="text-xs"><span class="text-dark ms-sm-2 font-weight-bold">Date:  </span>{{task.done_at}} </div>
                      <hr class="horizontal dark">
                      <div class=" row">
                        
                        <div class="  text-uppercase text-sm col-sm-8 mt-2">Description  </div>
                        <div class=" col-sm-4  text-end">
                          <a class="link btn-sm btn-primary px-3 me-3 py-1 text-center hideicon" data-bs-toggle="collapse" href="#collapseExample2" role="button" aria-expanded="false" aria-controls="collapseExample2"><i class="ni ni-bold-down text-white" aria-hidden="false"></i>
                        </a>
                        </div>
                      
                      </div>
                    
                      <div class="collapse" id="collapseExample2" data-bs-parent="#accordionRental">
                        {{task.description}}
                      </div>
                    </div>
                  </li>
                {% endfor %} 
                
             
                
               
              </ul>
            </div>
          </div>
        </div>
      </div>
      <div id="historical" class="">
        <div class="row mt-4">
          <div class="col-12">
            <div class="card mb-4">
              <div class="card-header pb-0">
                <h6>Historique de circulation</h6>
              </div>
              <div class="card-body px-0 pt-0 pb-2">
                <div class="table-responsive p-0">
                  <table class="table align-items-center mb-0">
                    <thead>
                      <tr>
                        <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7 ps-2">Designation</th>
                        <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7 ps-2">Ville</th>
                        <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7 ps-2">Quartier</th>
                        <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7 ps-2">Date</th>
                        <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7 ps-2"> heure</th>
              
                      </tr>
                    </thead>
                    <tbody>
                     
                     
                      {% for record in records %}
                      <tr>
                        <td>
                          <div class="d-flex px-2 py-1">
                            
                            <div class="d-flex flex-column justify-content-center">
                              <h6 class="mb-0 text-sm">{{record.reader.designation}}</h6>
                              
                            </div>
                          </div>
                        </td>
                       
                        <td>
                          <p class="text-xs font-weight-bold mb-0">{{record.reader.city.name}}</p>
                          
                        </td>
                        <td>
                          <p class="text-xs font-weight-bold mb-0">{{record.reader.district.name}}</p>
                          
                        </td>
                        <td>
                          <p class="text-xs font-weight-bold mb-0">{{record.create_at|date:"d/m/Y"}}</p>
                          
                        </td>
                        <td>
                          <p class="text-xs font-weight-bold mb-0">{{record.create_at|date:"H:i:s"}}</p>
                        </td>
                       
                      </tr>
                      {%endfor%}
                      
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
     
  </div>
</div>
    <script type="text/javascript">
        $("#nav_profile").click(function(){
          
          $("#profile").attr("class","d-block")
          
          $("#anomaly").attr("class","d-none")
          $("#report").attr("class","d-none")
          $("#historical").attr("class","d-none")
        })

        $("#nav_report").click(function(){
         
          $("#report").attr("class","d-block")
        
          $("#anomaly").attr("class","d-none")
          $("#profile").attr("class","d-none")
          $("#historical").attr("class","d-none")
        })

        $("#nav_anomaly").click(function(){
          
          $("#anomaly").attr("class","d-block")
        
          $("#profile").attr("class","d-none")
          $("#report").attr("class","d-none")
          $("#historical").attr("class","d-none")
        })
        $("#nav_historical").click(function(){
          $("#historical").attr("class","d-block")
          $("#anomaly").attr("class","d-none")
        
          $("#profile").attr("class","d-none")
          $("#report").attr("class","d-none")
        })
    </script>    
{% endblock %}
